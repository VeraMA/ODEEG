{% extends "webpage/base.html" %}
{% load staticfiles %}
{% load webpage_extras %}
{% block title %} {{ object.id_inv_nr }} {% endblock %}
{% block scriptHeader %}
    <!--STYLESHEET-->
    <link type="text/css" rel="stylesheet" href="{% static 'webpage/libraries/3dhop/stylesheet/3dhop.css' %}"/>
    <!--SPIDERGL-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/spidergl.js' %}"></script>

    <!--PRESENTER-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/presenter.js' %}"></script>
    <!--3D MODELS LOADING AND RENDERING-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/nexus.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/ply.js' %}"></script>
    <!--TRACKBALLS-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/trackball_sphere.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/trackball_turntable.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/trackball_turntable_pan.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/trackball_pantilt.js' %}"></script>
    <!--UTILITY-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/js/init.js' %}"></script>

    <!--OpenSeadragon-->
    <script type="text/javascript" src="{% static 'webpage/libraries/openseadragon/openseadragon.min.js' %}"></script>
{% endblock %}
{% block content %}
    <div class="card procustom-panel-create">
        <div class="card-header procustom-panel-heading">
            <div class="row">
                <div class="col-md-1 offset-lg-2">
                    {% if object.get_prev %}
                        <h2>
                            <a href="{% url 'dobjects:digitalcontainer_detail' pk=object.get_prev %}">
                                <i class="fas fa-chevron-left" title="previous"></i>
                            </a>
                        </h2>
                    {% endif %}
                </div>
                <div class="col-md-6" style="text-align:center">
                    <h1 class="detail-title">
                         <small><a href="{{ object.get_listview_url }}">object:</a> </small>{{ object }}
                        {% if user.is_authenticated %}
                            <small>
                                <a href="{% url 'dobjects:digitalcontainer_edit' pk=object.id %}">
                                    <i class="far fa-edit" title="edit"></i>
                                </a>
                            </small>
                            |
                            <small>
                                <a href="{% url 'dobjects:digitalcontainer_delete' pk=object.id %}">
                                   <i class="far fa-trash-alt" title="delete"></i>
                                </a>
                            </small>
                        {% endif %}
                    </h1>
                </div>
                <div class="col-md-1">
                    <h2>
                        {% if object.get_next %}
                        <a href="{% url 'dobjects:digitalcontainer_detail' pk=object.get_next %}" style="float:right">
                            <i class="fas fa-chevron-right" title="next"></i>
                        </a>
                    </h2>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-3 offset-lg-1 detail-left-side">
                    {% if imgs %}
                        <legend>
                            Images
                        </legend>
                      {% for x in imgs %}
                          <li>
                              <a href="{{ x.acdh_id }}?format=raw">{{ x }}</a>
                          </li>
                      {% endfor %}
                    {% endif %}
                    {% if illustrations %}
                      <legend>
                          Illustrations
                      </legend>
                      {% for x in illustrations %}
                          <li>
                              {{ x }}
                          </li>
                      {% endfor %}
                    {% endif %}
                    {% if threeds %}
                      <legend>
                          3D Data
                      </legend>
                      {% for x in threeds %}
                          <li>
                              {{ x }}
                          </li>
                      {% endfor %}
                    {% endif %}
                </div>
                <div class="col-md-5">
                    <table class="table table-information table-hover">
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "folder_name" %}
                                    <i class="fas fa-info-circle" data-toggle="tooltip" data-html="true" title="{% get_help_text digitalcontainer 'folder_name' %}"></i>
                                </th>
                                <td>
                                    {{ object.folder_name }}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "located_at" %}</th>
                                <td>
                                    <a href="{{ object.located_at.get_absolute_url }}">{{ object.located_at }}</a>
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "id_inv_nr" %}</th>
                                <td>
                                    {{ object.id_inv_nr }}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "bapd_nr" %}</th>
                                <td>
                                    {{ object.bapd_nr }}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "period" %}</th>
                                <td>
                                    <a href="{{ object.period.get_absolute_url }}">{{ object.period }}</a>
                                </td>
                            </tr>
                            <tr>
                                <th>Date Range</th>
                                <td>
                                    <a href="{{ object.period.get_absolute_url }}">{{ object.period.get_dates_str }}</a>
                                </td>
                            </tr>
                            <tr>
                                <th>Provenance</th>
                                <td>
                                    <small>{% get_verbose_name digitalcontainer "pl_find" %}:</small> <a href="{{ object.pl_find.get_absolute_url }}">{{ object.pl_find }}</a>
                                    {% if object.pl_find_cert %}
                                    ({{ object.pl_find_cert }})
                                    {% endif %} <br/>
                                    <small>{% get_verbose_name digitalcontainer "pl_prod_center" %}:</small> <a href="{{ object.pl_prod_center.get_absolute_url }}">{{ object.pl_prod_center }}</a>
                                    {% if object.prov_attr_artist %}
                                      <small>{% get_verbose_name digitalcontainer "prov_attr_artist" %}:</small> {{ object.prov_attr_artist }}
                                    {% endif %}
                                    <br/>
                                    <small>{% get_verbose_name digitalcontainer "pl_acq" %}:</small> <a href="{{ object.pl_acq.get_absolute_url }}">{{ object.pl_acq }}</a>
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "shape_name" %}</th>
                                <td>
                                    {% for x in object.shape_name.all %}
                                        <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                    {%  endfor  %}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "fabric" %}</th>
                                <td>
                                    {% for x in object.fabric.all %}
                                        <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                    {%  endfor  %}
                                </td>
                            </tr>
                            <tr>
                                <th>Technique</th>
                                <td>
                                    <small>Painting:</small> {% for x in object.painting_style.all %}
                                        <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                    {%  endfor  %}
                                    {% if object.painting_sub_technique.all %}
                                    /
                                    {% for x in object.painting_sub_technique.all %}
                                         <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                    {%  endfor  %}
                                    {% endif %}

                                    <br/>
                                    <small>Forming:</small> {% for x in object.formating_technique.all %}
                                        <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                    {%  endfor  %}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "cva_ref" %}</th>
                                <td>
                                    {{ object.cva_ref }}
                                </td>
                            </tr>
                            <tr>
                                <th>{% get_verbose_name digitalcontainer "collection_reference" %}</th>
                                <td>
                                    <a href="{{ object.collection_reference }}">{{ object.collection_reference }}</a>
                                </td>
                            </tr>
                            {% if object.related_object.all %}
                                <tr>
                                    <th>{% get_verbose_name digitalcontainer "related_object" %}</th>
                                    <td>
                                        {% for x in object.related_object.all %}
                                            <a href="{{ x.get_absolute_url }}">{{ x }}</a>
                                        {%  endfor  %}
                                    </td>
                                </tr>
                            {% endif %}
                    </table>
                    <hr class="hr-detail-view"/>
                    <legend>Measurements</legend>
                    <table class="table table-information table-hover">
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "weight" %}</th>
                            <td>
                                {{ object.weight }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "height" %}</th>
                            <td>
                                {{ object.height }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "width" %}</th>
                            <td>
                                {{ object.width }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "length" %}</th>
                            <td>
                                {{ object.length }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "filling_height" %}</th>
                            <td>
                                {{ object.filling_height }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "filling_volume" %}</th>
                            <td>
                                {{ object.filling_volume }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "material_volume" %}</th>
                            <td>
                                {{ object.material_volume }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "material_density" %}</th>
                            <td>
                                {{ object.material_density }}
                            </td>
                        </tr>
                        <tr>
                            <th>{% get_verbose_name digitalcontainer "outer_volume" %}</th>
                            <td>
                                {{ object.outer_volume }}
                            </td>
                        </tr>
                    </table>

                    {% if object.has_threed.all %}
                        {% for x in object.has_threed.all %}
                            <hr class="hr-detail-view"/>
                            <legend>3d Models</legend>
                            <table class="table table-information table-hover">
                                <tr>
                                    <th>3D Scanner <small><a href="{{ x.get_absolute_url }}">more</a></small></th>
                                    <td>
                                        <small>type:</small> {{ x.img_technique }}<br/>
                                        <small>hardware:</small> {{ x.hardware }}
                                    </td>
                                </tr>
                                <tr>
                                    <th>3D Data</th>
                                    <td>
                                        <small>acquisition:</small> {{ x.survey_location }}
                                    </td>
                                </tr>
                            </table>
                        {% endfor %}
                    {% endif %}
                    {% if object.has_photo.all %}
                        {% for x in object.has_photo.all %}
                            <hr class="hr-detail-view"/>
                            <legend>Photographs</legend>
                            <table class="table table-information table-hover">
                                <tr>
                                    <th>by</th>
                                    <td>
                                        {% for y in x.creator.all %}
                                            <li>
                                                <a href="{{ y.get_absolute_url }}">{{ y }}</a>
                                            </li>
                                        {% endfor %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>with</th>
                                    <td>
                                        <small>software:</small> {{ x.software}}<br/>
                                        <small>post processing methods:</small> {{ x.post_processing_method }}
                                    </td>
                                </tr>
                                <tr>
                                    <th>when</th>
                                    <td>
                                        {{ x.start_date }}
                                    </td>
                                </tr>
                            </table>
                        {% endfor %}
                    {% endif %}
                    {% if object.has_illustration.all %}
                        {% for x in object.has_illustration.all %}
                            <hr class="hr-detail-view"/>
                            <legend>Illustrations</legend>
                            <table class="table table-information table-hover">
                                <tr>
                                    <th>by</th>
                                    <td>
                                        {% for y in x.creator.all %}
                                            <li>
                                                <a href="{{ y.get_absolute_url }}">{{ y }}</a>
                                            </li>
                                        {% endfor %}
                                    </td>
                                </tr>
                                <tr>
                                    <th>with</th>
                                    <td>
                                        {% for y in x.software.all %}
                                            <small>software:</small> {{ y }}<br/>
                                        {% endfor %}
                                        <small>post processing methods:</small> {{ x.post_processing_method }}
                                    </td>
                                </tr>
                                <tr>
                                    <th>when</th>
                                    <td>
                                        {{ x.start_date }}
                                    </td>
                                </tr>
                            </table>
                        {% endfor %}
                    {% endif %}
                </div>
                <div class="col-md-3">
                    some notes
                </div>
            </div>

            <div id="binaries" class="container">
                <ul class="nav nav-tabs" id="myTab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="threed-tab" data-toggle="tab" href="#threed" role="tab" aria-controls="threed" aria-selected="true">3D-Viewer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="IIIF-tab" data-toggle="tab" href="#IIIF" role="tab" aria-controls="IIIF" aria-selected="false">Image-Viewer</a>
                    </li>

                </ul>

                <div class="tab-content" id="myTabContent">
                    <div class="tab-pane fade show active" id="threed" role="tabpanel" aria-labelledby="threed-tab">
                        {% if 3d %}
                            <div id="3dhop" class="tdhop" onmousedown="if (event.preventDefault) event.preventDefault()">
                                <div id="toolbar">
                                    <img id="home"     title="Home"                  src="{% static 'webpage/libraries/3dhop/skins/dark/home.png' %}"   /><br/>
                                    <img id="zoomin"   title="Zoom In"               src="{% static 'webpage/libraries/3dhop/skins/dark/zoomin.png' %}" /><br/>
                                    <img id="zoomout"  title="Zoom Out"              src="{% static 'webpage/libraries/3dhop/skins/dark/zoomout.png' %}"/><br/>
                                    <img id="light_on" title="Disable Light Control" src="{% static 'webpage/libraries/3dhop/skins/dark/light_on.png' %}" style="position:absolute; visibility:hidden;"/>
                                    <img id="light"    title="Enable Light Control"  src="{% static 'webpage/libraries/3dhop/skins/dark/light.png' %}"/><br/>
                                    <img id="full_on"  title="Exit Full Screen"      src="{% static 'webpage/libraries/3dhop/skins/dark/full_on.png' %}" style="position:absolute; visibility:hidden;"/>
                                    <img id="full"     title="Full Screen"           src="{% static 'webpage/libraries/3dhop/skins/dark/full.png' %}"   />
                                </div>
                                <canvas id="draw-canvas"/>
                            </div>
                          {% else %}
                          <h4>no 3d objects for this objects stored in ARCHE</h4>
                    {% endif %}
                    </div>
                    <div class="tab-pane fade" id="IIIF" role="tabpanel" aria-labelledby="IIIF-tab">
                        {% if iiif %}
                            <div id="example-xmlhttprequest-for-info-json" class="openseadragon" style="width: 100%; height: 400px">
                                <script type="text/javascript">
                                    OpenSeadragon({
                                        id:            "example-xmlhttprequest-for-info-json",
                                        prefixUrl:     "{% static 'webpage/libraries/openseadragon/images/' %}",
                                        sequenceMode:  true,
                                        showReferenceStrip: true,
                                        referenceStripHeight: 100,
                                        tileSources :  {{ iiif|safe }}
                                    });
                                </script>
                                <noscript>
                                    <p>OpenSeadragon is not available unless JavaScript is enabled.</p>
                                    <img src='/example-images/highsmith/01967v.jpg'
                                         height='600'/>
                                </noscript>
                            </div>
                        {% else %}
                            <h4>No images for this object stored in ARCHE</h4>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block scripts2 %}
{% if 3d %}
    <script type="text/javascript">
        var presenter = null;
        function setup3dhop() {
            presenter = new Presenter("draw-canvas");
            // var meshUrl = "{% static 'webpage/libraries/3dhop/models/KHM-ANSA-IV1_3D02.ply' %}";
            var meshUrl = "{{ 3d }}"
            presenter.setScene({
                meshes: {
                    "3dmodel" : { url: meshUrl }
                },
                modelInstances : {
                    "Model1" : { mesh : "3dmodel" }
                }
            });
        }

        function actionsToolbar(action) {
            if(action=='home') presenter.resetTrackball();
            else if(action=='zoomin') presenter.zoomIn();
            else if(action=='zoomout') presenter.zoomOut();
            else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); }
            else if(action=='full'  || action=='full_on') fullscreenSwitch();
        }

        $(document).ready(function(){
            init3dhop();
            setup3dhop();
            resizeCanvas(1200,800);
            moveToolbar(2,2);
        });
    </script>
{% endif %}
{% endblock scripts2 %}
