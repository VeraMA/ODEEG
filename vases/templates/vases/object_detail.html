{% extends "browsing/generic_detail.html" %}
{% load staticfiles %}
{% load webpage_extras %}
{% load vases_extras %}
{% block title %}{{ object }}{% endblock %}
{% block custom %}

<!-- 3DHOP -->
    <!--STYLESHEET-->
    <link type="text/css" rel="stylesheet" href="{% static 'webpage/libraries/3dhop/minimal/stylesheet/3dhop.css' %}"/>
    <!--SPIDERGL-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/spidergl.js' %}"></script>

    <!--PRESENTER-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/presenter.js' %}"></script>
    <!--3D MODELS LOADING AND RENDERING-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/nexus.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/ply.js' %}"></script>
    <!--TRACKBALLS-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_sphere.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_turntable.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_turntable_pan.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_pantilt.js' %}"></script>
    <!--UTILITY-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/init.js' %}"></script>

<div class="row">
  <div class="col-md-4" id="left-list">
    <div class="card">
        <div class="card-body">
      <!--  {% for x in  object.get_thumbs %}
            <li>
                <img src="{{ x }}" >
            </li>
        {% endfor %}-->
        <h3>3D Model</h3>
      {% get_item_by_type object '3Dscan_lowRes-data' as items %}
      {% if items %}
        <div>
          <div id="3dhop" class="tdhop" onmousedown="if (event.preventDefault) event.preventDefault()">
            <div id="toolbar">
                <img id="home" title="Home" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/home.png' %}"/><br/>
                <img id="zoomin" title="Zoom In" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/zoomin.png' %}"/><br/>
                <img id="zoomout" title="Zoom Out" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/zoomout.png' %}"/><br/>
                <img id="light_on" title="Disable Light Control" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/light_on.png' %}" style="position:absolute; visibility:hidden;"/>
                <img id="light" title="Enable Light Control" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/light.png' %}"/><br/>
                <img id="full_on" title="Exit Full Screen" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/full_on.png' %}" style="position:absolute; visibility:hidden;"/>
                <img id="full" title="Full Screen" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/full.png' %}"/>
            </div>
            <canvas id="draw-canvas" style="height: 350px;"/>
          </div>
        </div>
        {% with newMeshUrl=items.0.id  %}
          <script type="text/javascript">
              var presenter = null;
              function setup3dhop() {
                  presenter = new Presenter("draw-canvas");
                  var meshUrl = "{{ newMeshUrl }}"
                  presenter.setScene({
                      meshes: {
                          "3dmodel" : { url: meshUrl }
                      },
                      modelInstances : {
                          "Model1" : { mesh : "3dmodel" }
                      }
                  });
              }
              function actionsToolbar(action) {
                  if(action=='home') presenter.resetTrackball();
                  else if(action=='zoomin') presenter.zoomIn();
                  else if(action=='zoomout') presenter.zoomOut();
                  else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); }
                  else if(action=='full'  || action=='full_on') fullscreenSwitch();
              }

              $(document).ready(function(){
                  init3dhop();
                  setup3dhop();
                  moveToolbar(0,5);
              });
          </script>
        {% endwith %}
      {% else %}
        <p>No 3D model available for this object.</p>
      {% endif %}
      <hr />
      <h3>Photos</h3>
      {% get_item_by_type object 'Photos' as photoItems %}
      {% if photoItems %}
        <div id="openseadragon-photo" style="height: 350px;"></div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/openseadragon.min.js"></script>
        <script type="text/javascript">
            var viewer = OpenSeadragon({
                id: "openseadragon-photo",
                protocol: "http://iiif.io/api/image",
                prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/images/",
                sequenceMode : true,
                showReferenceStrip: true,
                tileSources: [
                    {% for x in photoItems %}
                        "{{ x.id }}?PARAM=info.json&format=iiif"{% if not forloop.last %}, {% endif %}
                    {% endfor %}]
            });
        </script>
      {% else %}
        <p>No photos available for this object.</p>
      {% endif %}
      <hr />
      <h3>Illustrations</h3>
      {% get_item_by_type object 'Illustrations' as illItems %}
      {% if illItems %}
      <div id="openseadragon-ill" style="height: 350px;"></div>
      <script type="text/javascript">
          var viewer = OpenSeadragon({
              id: "openseadragon-ill",
              protocol: "http://iiif.io/api/image",
              prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/images/",
              sequenceMode : true,
              showReferenceStrip: true,
              tileSources: [
                  {% for x in illItems %}
                      "{{ x.id }}?PARAM=info.json&format=iiif"{% if not forloop.last %}, {% endif %}
                  {% endfor %}]
          });
      </script>
      {% else %}
        <p>No illustrations available for this object.</p>
      {% endif %}
      <hr />
      <h3>Illustration Panel</h3>
      {% get_item_by_type object 'IllustrationTables' as illtabItems %}
      {% if illtabItems %}
      <div id="openseadragon-illtab" style="height: 350px;"></div>
      <script type="text/javascript">
          var viewer = OpenSeadragon({
              id: "openseadragon-illtab",
              protocol: "http://iiif.io/api/image",
              prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/images/",
              sequenceMode : true,
              showReferenceStrip: true,
              tileSources: [
                  {% for x in illtabItems %}
                    {%if '.svg' not in x.id %}
                      "{{ x.id }}?PARAM=info.json&format=iiif"{% if not forloop.last %}, {% endif %}
                    {% endif %}
                  {% endfor %}]
          });
      </script>
      {% else %}
        <p>No illustrations panel available for this object.</p>
      {% endif %}

      </div>
      </div>
    </div>
    <div class="col-md-8">
      <table class="table table-responsive table-information table-hover">
        <tr>
            <th>{% get_verbose_name object "folder_name" %}
                <span data-toggle="tooltip" data-placement="right" data-html="true" title="{% get_help_text object 'folder_name' %}"> <i data-feather="info"></i></span>
            </th>
            <td>
                {{ object.folder_name }}
            </td>
        </tr>
        <tr>
            <th><span data-toggle="tooltip" data-placement="right" data-html="true" title="{% get_help_text object 'collection_spec' %}">{% get_verbose_name object "collection_spec" %}</span></th>
            <td>
                {{ object.collection_spec }}, <a href="{{ object.collection_inst.get_absolute_url }}">{{ object.collection_inst }}</a>
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "inv_nr" %}</th>
            <td>
                {{ object.inv_nr }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "bapd_nr" %}</th>
            <td>
                {% if  object.bapd_nr == 'nan' %}&ndash;
                {% else %} {{ object.bapd_nr|default:"&ndash" }}
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "shape" %}</th>
            <td>
                {% for y in object.shape.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y.shape }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
                {% if object.shape_comp.all.0.shape_comp %}
                  <br/>
                  <small>Components:</small>
                  {% for y in object.shape_comp.all %}
                    <a href="{{y.get_absolute_url }}">{{ y.shape_comp }}</a>{% if not forloop.last %}, {% endif %}
                  {% endfor %}
                {% endif %}
                <br/>
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "period" %}</th>
            <td>
              {% for y in object.period.all %}
                <a href="{{ y.get_absolute_url }}">{{ y.period }}{% if y.get_dates_str %}
                  ({{ y.get_dates_str }}){% endif %}</a>{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </td>
        </tr>
        <tr>
            <th>Object dating</th>
            <td>
              {{ object.get_dating_str }}
            </td>
        </tr>
        <tr>
            <th>Provenance</th>
            <td>
                <small>{% get_verbose_name object "provenance_spot" %}:</small> <a href="{{ object.provenance_spot.get_absolute_url }}">{% if object.provenance_spot.place_name == '(no data entered)' %} &ndash; {% else %}{{ object.provenance_spot }}{% endif %}</a>
                {% if object.provenance_spot_cert %}
                <small>({{ object.provenance_spot_cert.cert_label }} <a href="http://vocab.getty.edu/page/aat/{{ object.provenance_spot_cert.cert_id }}"><i data-feather="external-link"></i></a>)</small>
                {% endif %}
                <br/>
                <small>{% get_verbose_name object "provenance_production" %}:</small> <a href="{{ object.provenance_production.get_absolute_url }}">{% if object.provenance_production.place_name == '(no data entered)' %} &ndash;{% else %}{{ object.provenance_production }}{% endif %}</a>
                {% if object.provenance_production_cert %}
                <small>({{ object.provenance_production_cert.cert_label }} <a href="http://vocab.getty.edu/page/aat/{{ object.provenance_spot_production.cert_id }}"><i data-feather="external-link"></i></a>)</small>
                {% endif %}
                {% if object.prov_attr_artist %}
                  <small>{% get_verbose_name object "provenance_attribution" %}:</small> {{ object.provenance_attribution }}
                {% endif %}
                <br/>
                <small>{% get_verbose_name object "provenance_acquisition" %}:</small>
                  {% for y in object.provenance_acquisition.all %}<a href="{{y.get_absolute_url }}">{% if y.place_name == '(no data entered)' %} &ndash;{% else %}{{ y.place_name }}</a>{% if not forloop.last %}, {% endif %}{% endif %}
                  {% endfor %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "culture" %}</th>
            <td>
                {% for y in object.culture.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y }}</a>{% if not forloop.last %}, {% endif %}
                {%  endfor  %}
            </td>
        </tr>
        <tr>
            <th>Material</th>
            <td>
              <small>{% get_verbose_name object "material" %}:</small>
              {% for y in object.material.all %}
                <a href="{{ y.get_absolute_url }}">{{ y }}</a>{% if not forloop.last %}, {% endif %}
              {%  endfor  %}
              <br/>
              <small>{% get_verbose_name object "material_fabric" %}:</small>
              {% for y in object.material_fabric.all %}
                  <a href="{{ y.get_absolute_url }}">{{ y }}</a>{% if not forloop.last %}, {% endif %}
              {%  endfor  %}
            </td>
        </tr>
        <tr>
            <th>Technique</th>
            <td>
                <small>{% get_verbose_name object "painting_style" %}:</small>
                {% for y in object.painting_style.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y }}</a>{% if not forloop.last %}, {% endif %}
                {%  endfor  %}
                <br/>
                <small>{% get_verbose_name object "painting_style_sub" %}:</small>
                {% for y in object.painting_style_sub.all %}
                     <a href="{{ y.get_absolute_url }}">{{ y|default_if_none:"&ndash;" }}</a>{% if not forloop.last %}, {% endif %}
                {% empty %}
                  &ndash;
                {%  endfor  %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "bibref" %}</th>
            <td>
                {{ object.bibref }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "collref" %}</th>
            <td>
              {% if object.collref %}
                {% if not object.collref == 'nan' %}
                  <a href="{{ object.collref }}">{{ object.collref }}<i data-feather="external-link"></i></a>
                {% endif %}
              {% else %}
                &ndash;
              {% endif %}
            </td>
        </tr>
        {% if object.object_associated_to_inv.all %}
            <tr>
                <th>{% get_verbose_name object "object_associated_to_inv" %}</th>
                <td>
                    {% for y in object.object_associated_to_inv.all %}
                        <a href="{{ y.get_absolute_url }}">{{ y }} ({{ y.folder_name }})</a>
                    {%  endfor  %}
                </td>
            </tr>
        {% endif %}
        <tr>
            <th>{% get_verbose_name object "object_notes" %}</th>
            <td>
                {{ object.notes }}
            </td>
        </tr>
      </div>
      <hr class="hr-detail-view"/>
       <legend>Measurements</legend>
       <table class="table table-responsive table-information table-hover">
           <tr>
               <th>{% get_verbose_name object "weight" %}</th>
               <td>
                 {% if not object.weight|stringformat:"s" == "NaN" %}
                   {{ object.weight|floatformat:3  }}
                   {% else %}
                     &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "height" %}</th>
               <td>
                {% if not object.height|stringformat:"s" == "NaN" %}
                   {{ object.height|floatformat:3  }}
                   {% else %}
                     &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "width" %}</th>
               <td>
                {% if not object.width|stringformat:"s" == "NaN" %}
                   {{ object.width|floatformat:3  }}
                   {% else %}
                     &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "length" %}</th>
               <td>
                {% if not object.length|stringformat:"s" == "NaN" %}
                   {{ object.length|floatformat:3  }}
                   {% else %}
                     &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "fillingheight" %}</th>
               <td>
                 {% if not object.fillingheight|stringformat:"s" == "NaN" %}
                   {{ object.fillingheight|floatformat:3  }}
                   {% else %}
                     &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "fillingvolume" %}</th>
               <td>
                 {% if not object.fillingvolume|stringformat:"s" == "NaN" %}
                   {{ object.fillingvolume|floatformat:3  }}
                 {% else %}
                   &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "materialvolume" %}</th>
               <td>
                 {% if not object.materialvolume|stringformat:"s" == "NaN" %}
                   {{ object.materialvolume|floatformat:3  }}
                 {% else %}
                   &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "materialdensity" %}</th>
               <td>
                 {% if not object.materialdensity|stringformat:"s" == "NaN" %}
                   {{ object.materialdensity|floatformat:3  }}{% if object.materialdensity_measure and not object.materialdensity_measure == 'nan' %} - {{ object.materialdensity_measure }}{% endif %}
                 {% else %}
                   &ndash;
                 {% endif %}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "boundingbox" %}</th>
               <td>
                 {% if not object.boundingbox|stringformat:"s" == "NaN" %}
                   {{ object.boundingbox|floatformat:3  }}
                 {% else %}
                   &ndash;
                 {% endif %}
               </td>
           </tr>
       </table>
      {% if object.rvn_threeddata_folder_name_object.all %}
         {% for y in object.rvn_threeddata_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>3D Models</legend>
             <table class="table table-responsive table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}
      {% if object.rvn_illustration_folder_name_object.all %}
         {% for y in object.rvn_illustration_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>Illustrations</legend>
             <table class="table table-responsive table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}
      {% if object.rvn_illustrationpanel_folder_name_object.all %}
         {% for y in object.rvn_illustrationpanel_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>Illustration Panels</legend>
             <table class="table table-responsive table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}
      </div>
    </div>
{% endblock custom %}

<!--
  <script type="text/javascript">
      var presenter = null;
      function setup3dhop() {
          presenter = new Presenter("draw-canvas");
          // var meshUrl = "{% static 'webpage/libraries/3dhop/models/KHM-ANSA-IV1_3D02.ply' %}";
          var meshUrl = "{% get_item_by_type object '3Dscan_lowRes-data' as items %}
                  {{ items.0.id }}"
          presenter.setScene({
              meshes: {
                  "3dmodel" : { url: meshUrl }
              },
              modelInstances : {
                  "Model1" : { mesh : "3dmodel" }
              }
          });
      }

      function actionsToolbar(action) {
          if(action=='home') presenter.resetTrackball();
          else if(action=='zoomin') presenter.zoomIn();
          else if(action=='zoomout') presenter.zoomOut();
          else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); }
          else if(action=='full'  || action=='full_on') fullscreenSwitch();
      }

      $(document).ready(function(){
          init3dhop();
          setup3dhop();
          moveToolbar(0,5);
      });
  </script>
  -->
