{% extends "browsing/generic_detail.html" %}
{% load staticfiles %}
{% load webpage_extras %}
{% load vases_extras %}
{% block title %}{{ object }}{% endblock %}
{% block custom %}

<!-- 3DHOP -->
    <!--STYLESHEET-->
    <link type="text/css" rel="stylesheet" href="{% static 'webpage/libraries/3dhop/minimal/stylesheet/3dhop.css' %}"/>
    <!--SPIDERGL-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/spidergl.js' %}"></script>

    <!--PRESENTER-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/presenter.js' %}"></script>
    <!--3D MODELS LOADING AND RENDERING-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/nexus.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/ply.js' %}"></script>
    <!--TRACKBALLS-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_sphere.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_turntable.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_turntable_pan.js' %}"></script>
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/trackball_pantilt.js' %}"></script>
    <!--UTILITY-->
    <script type="text/javascript" src="{% static 'webpage/libraries/3dhop/minimal/js/init.js' %}"></script>

<div class="row">
  <div class="col-md-4" id="left-list">
    <div class="card">
        <div class="card-body">
      <!--  {% for x in  object.get_thumbs %}
            <li>
                <img src="{{ x }}" >
            </li>
        {% endfor %}-->
        <h2>3D Model</h2>
        {% get_item_by_type object '3Dscan_lowRes-data' as items %}
        {{ items.0.id }}
        <br/>List:
        {% for x in items %}
        {{ x.id }}{% if not forloop.last %},
        {% endif %}
        {% endfor %}
        <div>
        <div id="3dhop" class="tdhop" onmousedown="if (event.preventDefault) event.preventDefault()">
        <div id="toolbar">
            <img id="home" title="Home" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/home.png' %}"/><br/>
            <img id="zoomin" title="Zoom In" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/zoomin.png' %}"/><br/>
            <img id="zoomout" title="Zoom Out" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/zoomout.png' %}"/><br/>
            <img id="light_on" title="Disable Light Control" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/light_on.png' %}" style="position:absolute; visibility:hidden;"/>
            <img id="light" title="Enable Light Control" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/light.png' %}"/><br/>
            <img id="full_on" title="Exit Full Screen" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/full_on.png' %}" style="position:absolute; visibility:hidden;"/>
            <img id="full" title="Full Screen" src="{% static 'webpage/libraries/3dhop/minimal/skins/dark/full.png' %}"/>
        </div>
        <canvas id="draw-canvas" style="height: 350px;"/>
        </div>
      </div>
      <script type="text/javascript">
          var presenter = null;
          function setup3dhop() {
              presenter = new Presenter("draw-canvas");
              var meshUrl = " https://id.acdh.oeaw.ac.at/ODeeg/Collections/AT-Vienna-KHM/KHM-ANSA-IV3/3D-data/3Dscan_lowRes-data/KHM-ANSA-IV3_3D02.ply"
              presenter.setScene({
                  meshes: {
                      "3dmodel" : { url: meshUrl }
                  },
                  modelInstances : {
                      "Model1" : { mesh : "3dmodel" }
                  }
              });
          }

          function actionsToolbar(action) {
              if(action=='home') presenter.resetTrackball();
              else if(action=='zoomin') presenter.zoomIn();
              else if(action=='zoomout') presenter.zoomOut();
              else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); }
              else if(action=='full'  || action=='full_on') fullscreenSwitch();
          }

          $(document).ready(function(){
              init3dhop();
              setup3dhop();
          //    resizeCanvas(300,350);
              moveToolbar(0,5);
          });
      </script>
      <hr />
      <legend>Photos</legend>
      <div id="openseadragon-photo" style="height: 350px;"></div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/openseadragon.min.js"></script>
      <script type="text/javascript">
          var viewer = OpenSeadragon({
              id: "openseadragon-photo",
              protocol: "http://iiif.io/api/image",
              prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/images/",
              sequenceMode : true,
              showReferenceStrip: true,
              tileSources: [{% get_item_by_type object 'Photos' as items %}
                  {% for x in items %}
                      "{{ x.id }}?PARAM=info.json&format=iiif"{% if not forloop.last %}, {% endif %}
                  {% endfor %}]
          });
      </script>
      <hr />
      <legend>Illustrations</legend>
      <div id="openseadragon-ill" style="height: 350px;"></div>
      <script type="text/javascript">
          var viewer = OpenSeadragon({
              id: "openseadragon-ill",
              protocol: "http://iiif.io/api/image",
              prefixUrl: "https://cdnjs.cloudflare.com/ajax/libs/openseadragon/2.4.1/images/",
              sequenceMode : true,
              showReferenceStrip: true,
              tileSources: [{% get_item_by_type object 'Illustrations' as items %}
                  {% for x in items %}
                      "{{ x.id }}?PARAM=info.json&format=iiif"{% if not forloop.last %}, {% endif %}
                  {% endfor %}]
          });
      </script>

      </div>
      </div>
    </div>
    <div class="col-md-8">
      <table class="table table-information table-hover">
        <tr>
            <th>{% get_verbose_name object "folder_name" %}
                <span data-toggle="tooltip" data-placement="right" data-html="true" title="{% get_help_text object 'folder_name' %}"> <i data-feather="info"></i></span>
            </th>
            <td>
                {{ object.folder_name }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "collection_spec" %}</th>
            <td>
                {{ object.collection_spec }}, <a href="{{ object.collection_inst.get_absolute_url }}">{{ object.collection_inst }}</a>
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "inv_nr" %}</th>
            <td>
                {{ object.inv_nr }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "bapd_nr" %}</th>
            <td>
                {{ object.bapd_nr }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "shape" %}</th>
            <td>
                {% for y in object.shape.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y.shape }}</a>{% if not forloop.last %}, {% endif %}
                {% endfor %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "period" %}</th>
            <td>
              {% for y in object.period.all %}
                <a href="{{ y.get_absolute_url }}">{{ y.period }}</a>
              <!--  {% if y.period.get_dates_str %}
                ({{ object.period.get_dates_str }})
                {% endif %} -->
                {% if not forloop.last %}, {% endif %}
              {% endfor %}
            </td>
        </tr>
        <tr>
            <th>Provenance</th>
            <td>
                <small>{% get_verbose_name object "provenance_spot" %}:</small> <a href="{{ object.provenance_spot.get_absolute_url }}">{% if object.provenance_spot %}{{ object.provenance_spot }}{% else %} &ndash; {% endif %}</a>
                {% if object.provenance_spot_cert %}
                ({{ object.provenance_spot_cert }})
                {% endif %} <br/>
                <small>{% get_verbose_name object "provenance_production" %}:</small> <a href="{{ object.provenance_production.get_absolute_url }}">{{ object.provenance_production }}</a>
                {% if object.prov_attr_artist %}
                  <small>{% get_verbose_name object "provenance_attribution" %}:</small> {{ object.provenance_attribution }}
                {% endif %}
                <br/>
                <small>{% get_verbose_name object "provenance_acquisition" %}:</small>
                {% for y in object.provenance_acquisition.all %}<a href="{{y.get_absolute_url }}">{{ y.place_name }}</a>{% if not forloop.last %}, {% endif %}
              {% endfor %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "material_fabric" %}</th>
            <td>
                {% for y in object.material_fabric.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y }}</a>
                    {% if not forloop.last %}, {% endif %}
                {%  endfor  %}
            </td>
        </tr>
        <tr>
            <th>Technique</th>
            <td>
                <small>Painting:</small> {% for x in object.painting_style.all %}
                    <a href="{{ y.get_absolute_url }}">{{ y }}</a>
                    {% if not forloop.last %}, {% endif %}
                {%  endfor  %}
                {% if object.painting_style_sub.all %}
                /
                {% for x in object.painting_style_sub.all %}
                     <a href="{{ y.get_absolute_url }}">{{ y }}</a>
                     {% if not forloop.last %}, {% endif %}
                {%  endfor  %}
                {% endif %}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "bibref" %}</th>
            <td>
                {{ object.bibref }}
            </td>
        </tr>
        <tr>
            <th>{% get_verbose_name object "collref" %}</th>
            <td>
                <a href="{{ object.collref }}">{{ object.collref }}</a>
            </td>
        </tr>
        {% if object.object_associated_to_inv.all %}
            <tr>
                <th>{% get_verbose_name object "object_associated_to_inv" %}</th>
                <td>
                    {% for y in object.object_associated_to_inv.all %}
                        <a href="{{ y.get_absolute_url }}">{{ y }} ({{ y.folder_name }})</a>
                    {%  endfor  %}
                </td>
            </tr>
        {% endif %}
      </table>
      <hr class="hr-detail-view"/>
       <legend>Measurements</legend>
       <table class="table table-information table-hover">
           <tr>
               <th>{% get_verbose_name object "weight" %}</th>
               <td>
                   {{ object.weight|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "height" %}</th>
               <td>
                   {{ object.height|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "width" %}</th>
               <td>
                   {{ object.width|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "length" %}</th>
               <td>
                   {{ object.length|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "fillingheight" %}</th>
               <td>
                   {{ object.fillingheight|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "fillingvolume" %}</th>
               <td>
                   {{ object.fillingvolume|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "materialvolume" %}</th>
               <td>
                   {{ object.materialvolume|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "materialdensity" %}</th>
               <td>
                   {{ object.materialdensity|floatformat:3  }}
               </td>
           </tr>
           <tr>
               <th>{% get_verbose_name object "boundingbox" %}</th>
               <td>
                   {{ object.boundingbox|floatformat:3  }}
               </td>
           </tr>
       </table>
      {% if object.rvn_threeddata_folder_name_object.all %}
         {% for y in object.rvn_threeddata_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>3D Models</legend>
             <table class="table table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}
      {% if object.rvn_illustration_folder_name_object.all %}
         {% for y in object.rvn_illustration_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>Illustrations</legend>
             <table class="table table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}
      {% if object.rvn_illustrationpanel_folder_name_object.all %}
         {% for y in object.rvn_illustrationpanel_folder_name_object.all %}
             <hr class="hr-detail-view"/>
             <legend>Illustration Panels</legend>
             <table class="table table-information table-hover">
                 <tr>
                     <th>3D Scanner <small><a href="{{ y.get_absolute_url }}">more</a></small></th>
                     <td>
                         <small>Type:</small> {{ y.threed_technique }}<br/>
                         <small>Hardware:</small> {{ y.threed_hardware }}<br/>
                         <small>Characteristics:</small> {{ y.threed_fov }}, {{ y.threed_resolution }}
                     </td>
                 </tr>
                 <tr>
                     <th>3D Data</th>
                     <td>
                         <small>acquisition:</small> {{ y.survey_location }}
                     </td>
                 </tr>
             </table>
        {% endfor %}
      {% endif %}

      <hr class="hr-detail-view"/>
      <table class="table table-information table-hover">

            {% for x in object.field_dict %}
                <tr>
                    <th>
                        {% if x.help_text %}
                            <abbr title="{{ x.help_text }}">{{ x.verbose_name }}</abbr>
                        {% else %}
                            {{ x.verbose_name }}
                        {% endif %}
                    </th>
                    <td>
                        {% if x.f_type == 'M2M' %}
                            {% for y in x.value %}
                                <li>
                                    <a href="{{ y.get_absolute_url }}">{{ y.legacy_id }}</a>
                                </li>
                            {% endfor %}
                        {% elif  x.f_type == 'FK' %}
                            <a href="{{ x.value.get_absolute_url }}">{{ x.value }}</a>
                        {% elif  x.f_type == 'FK' %}
                            <a href="{{ x.value.get_absolute_url }}">{{ x.value }}</a>
                        {% elif  x.f_type == 'SIMPLE' %}
                            {{ x.value }}
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>

        <hr class="hr-detail-view"/>
      </div>
    </div>
{% endblock custom %}

<!--
  <script type="text/javascript">
      var presenter = null;
      function setup3dhop() {
          presenter = new Presenter("draw-canvas");
          // var meshUrl = "{% static 'webpage/libraries/3dhop/models/KHM-ANSA-IV1_3D02.ply' %}";
          var meshUrl = "{% get_item_by_type object '3Dscan_lowRes-data' as items %}
                  {{ items.0.id }}"
          presenter.setScene({
              meshes: {
                  "3dmodel" : { url: meshUrl }
              },
              modelInstances : {
                  "Model1" : { mesh : "3dmodel" }
              }
          });
      }

      function actionsToolbar(action) {
          if(action=='home') presenter.resetTrackball();
          else if(action=='zoomin') presenter.zoomIn();
          else if(action=='zoomout') presenter.zoomOut();
          else if(action=='light' || action=='light_on') { presenter.enableLightTrackball(!presenter.isLightTrackballEnabled()); lightSwitch(); }
          else if(action=='full'  || action=='full_on') fullscreenSwitch();
      }

      $(document).ready(function(){
          init3dhop();
          setup3dhop();
          moveToolbar(0,5);
      });
  </script>
  -->
